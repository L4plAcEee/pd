{"version":3,"file":"message.js","sources":["pages/message/message.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9tZXNzYWdlLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"message-container\">\r\n    <!-- Ê∂àÊÅØÁ±ªÂûãÂàáÊç¢ -->\r\n    <view class=\"type-tabs\">\r\n      <view \r\n        class=\"tab-item\"\r\n        v-for=\"(tab, index) in tabs\"\r\n        :key=\"index\"\r\n        :class=\"{'tab-active': activeTab === index}\"\r\n        @tap=\"switchTab(index)\"\r\n      >\r\n        <text class=\"tab-name\">{{tab.name}}</text>\r\n        <text \r\n          class=\"unread-badge\"\r\n          v-if=\"tab.unread\"\r\n        >{{tab.unread}}</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- Ê∂àÊÅØÂàóË°® -->\r\n    <scroll-view \r\n      class=\"message-list\"\r\n      scroll-y\r\n      @scrolltolower=\"loadMore\"\r\n      :refresher-enabled=\"true\"\r\n      :refresher-triggered=\"refreshing\"\r\n      @refresherrefresh=\"refresh\"\r\n    >\r\n      <view \r\n        class=\"message-item\"\r\n        v-for=\"(msg, index) in filteredMessages\"\r\n        :key=\"msg.id\"\r\n        :class=\"{'msg-unread': !msg.read}\"\r\n        @tap=\"readMessage(msg)\"\r\n      >\r\n        <view class=\"msg-icon\" :class=\"msg.type\">\r\n          <text class=\"icon\">{{getIcon(msg.type)}}</text>\r\n        </view>\r\n        <view class=\"msg-content\">\r\n          <view class=\"msg-header\">\r\n            <text class=\"msg-title\">{{msg.title}}</text>\r\n            <text class=\"msg-time\">{{formatTime(msg.time)}}</text>\r\n          </view>\r\n          <text class=\"msg-desc\">{{msg.content}}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->\r\n      <view class=\"loading-more\" v-if=\"loading\">\r\n        <text>Âä†ËΩΩ‰∏≠...</text>\r\n      </view>\r\n      \r\n      <!-- Êó†Êï∞ÊçÆÊèêÁ§∫ -->\r\n      <view class=\"empty-tip\" v-if=\"filteredMessages.length === 0\">\r\n        <text>ÊöÇÊó†Ê∂àÊÅØ</text>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- ÊâπÈáèÊìç‰ΩúÊ†è -->\r\n    <view class=\"action-bar\" v-if=\"hasUnread\">\r\n      <button \r\n        class=\"action-btn\"\r\n        @tap=\"markAllRead\"\r\n      >ÂÖ®ÈÉ®Â∑≤ËØª</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      // Ê∂àÊÅØÁ±ªÂûã\r\n      tabs: [\r\n        { name: 'ÂÖ®ÈÉ®', unread: 5 },\r\n        { name: 'ËÆ¢Âçï', unread: 2 },\r\n        { name: 'ÂÆ°Êâπ', unread: 3 },\r\n        { name: 'ÂÖ¨Âëä', unread: 0 }\r\n      ],\r\n      activeTab: 0,\r\n\r\n      // Ê∂àÊÅØÂàóË°®\r\n      messages: [\r\n        {\r\n          id: 1,\r\n          type: 'order',\r\n          title: 'ËÆ¢ÂçïÁä∂ÊÄÅÊõ¥Êñ∞',\r\n          content: 'ÊÇ®ÁöÑËÆ¢ÂçïMF-20240315-001Â∑≤ÂÖ•Â∫ì',\r\n          time: Date.now() - 3600000,\r\n          read: false\r\n        },\r\n        {\r\n          id: 2,\r\n          type: 'approval',\r\n          title: 'ÂæÖÂÆ°ÊâπÊèêÈÜí',\r\n          content: 'ÊÇ®Êúâ2Á¨îËÆ¢ÂçïÂæÖË¥®Ê£ÄÔºåËØ∑ÂèäÊó∂Â§ÑÁêÜ',\r\n          time: Date.now() - 7200000,\r\n          read: false,\r\n          urgent: true\r\n        },\r\n        {\r\n          id: 3,\r\n          type: 'notice',\r\n          title: 'Á≥ªÁªüÂÖ¨Âëä',\r\n          content: 'Êú¨ÊúàÁªìÁÆóÊó∂Èó¥Ë∞ÉÊï¥ÈÄöÁü•',\r\n          time: Date.now() - 86400000,\r\n          read: true\r\n        }\r\n      ],\r\n\r\n      loading: false,\r\n      refreshing: false,\r\n      hasMore: true\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    // ËøáÊª§ÂêéÁöÑÊ∂àÊÅØÂàóË°®\r\n    filteredMessages() {\r\n      if(this.activeTab === 0) return this.messages\r\n      \r\n      const type = ['', 'order', 'approval', 'notice'][this.activeTab]\r\n      return this.messages.filter(msg => msg.type === type)\r\n    },\r\n\r\n    // ÊòØÂê¶ÊúâÊú™ËØªÊ∂àÊÅØ\r\n    hasUnread() {\r\n      return this.messages.some(msg => !msg.read)\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    // ÂàáÊç¢Ê∂àÊÅØÁ±ªÂûã\r\n    switchTab(index) {\r\n      this.activeTab = index\r\n    },\r\n\r\n    // Ëé∑ÂèñÊ∂àÊÅØÂõæÊ†á\r\n    getIcon(type) {\r\n      const icons = {\r\n        order: 'üì¶',\r\n        approval: 'üìù',\r\n        notice: 'üì¢'\r\n      }\r\n      return icons[type]\r\n    },\r\n\r\n    // ÈòÖËØªÊ∂àÊÅØ\r\n    async readMessage(msg) {\r\n      if(msg.read) return\r\n      \r\n      try {\r\n        // TODO: Ë∞ÉÁî®Â∑≤ËØªAPI\r\n        await new Promise(resolve => setTimeout(resolve, 500))\r\n        \r\n        msg.read = true\r\n        // Êõ¥Êñ∞Êú™ËØªÊï∞\r\n        this.updateUnreadCount()\r\n      } catch(e) {\r\n        console.error('Ê†áËÆ∞Â∑≤ËØªÂ§±Ë¥•:', e)\r\n      }\r\n    },\r\n\r\n    // ÂÖ®ÈÉ®Â∑≤ËØª\r\n    async markAllRead() {\r\n      try {\r\n        uni.showLoading({ title: 'Â§ÑÁêÜ‰∏≠' })\r\n        // TODO: Ë∞ÉÁî®ÊâπÈáèÂ∑≤ËØªAPI\r\n        await new Promise(resolve => setTimeout(resolve, 1000))\r\n        \r\n        this.messages.forEach(msg => msg.read = true)\r\n        this.updateUnreadCount()\r\n        \r\n        uni.showToast({ title: 'Â∑≤ÂÖ®ÈÉ®Ê†áËÆ∞‰∏∫Â∑≤ËØª' })\r\n      } catch(e) {\r\n        uni.showToast({ \r\n          title: 'Êìç‰ΩúÂ§±Ë¥•',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n\r\n    // Êõ¥Êñ∞Êú™ËØªÊï∞Èáè\r\n    updateUnreadCount() {\r\n      const counts = {\r\n        order: 0,\r\n        approval: 0,\r\n        notice: 0\r\n      }\r\n      \r\n      this.messages.forEach(msg => {\r\n        if(!msg.read) {\r\n          counts[msg.type]++\r\n        }\r\n      })\r\n      \r\n      this.tabs[0].unread = Object.values(counts).reduce((a, b) => a + b, 0)\r\n      this.tabs[1].unread = counts.order\r\n      this.tabs[2].unread = counts.approval\r\n      this.tabs[3].unread = counts.notice\r\n    },\r\n\r\n    // Âä†ËΩΩÊõ¥Â§ö\r\n    async loadMore() {\r\n      if(this.loading || !this.hasMore) return\r\n      \r\n      this.loading = true\r\n      try {\r\n        // TODO: Ë∞ÉÁî®Âä†ËΩΩÊõ¥Â§öAPI\r\n        await new Promise(resolve => setTimeout(resolve, 1000))\r\n        \r\n        // Ê®°ÊãüÂä†ËΩΩÊï∞ÊçÆ\r\n        const newMessages = []\r\n        this.messages.push(...newMessages)\r\n        \r\n        this.hasMore = newMessages.length === 10\r\n      } catch(e) {\r\n        console.error('Âä†ËΩΩÂ§±Ë¥•:', e)\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n\r\n    // ‰∏ãÊãâÂà∑Êñ∞\r\n    async refresh() {\r\n      this.refreshing = true\r\n      try {\r\n        // TODO: Ë∞ÉÁî®Âà∑Êñ∞API\r\n        await new Promise(resolve => setTimeout(resolve, 1000))\r\n        \r\n        // ÈáçÁΩÆÊï∞ÊçÆ\r\n        this.messages = []\r\n        this.hasMore = true\r\n        await this.loadMore()\r\n        \r\n      } finally {\r\n        this.refreshing = false\r\n      }\r\n    },\r\n\r\n    // Ê†ºÂºèÂåñÊó∂Èó¥\r\n    formatTime(timestamp) {\r\n      const now = Date.now()\r\n      const diff = now - timestamp\r\n      \r\n      if(diff < 3600000) {\r\n        return Math.floor(diff / 60000) + 'ÂàÜÈíüÂâç'\r\n      }\r\n      if(diff < 86400000) {\r\n        return Math.floor(diff / 3600000) + 'Â∞èÊó∂Ââç'\r\n      }\r\n      \r\n      const date = new Date(timestamp)\r\n      return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${date.getMinutes()}`\r\n    }\r\n  },\r\n\r\n  onShow() {\r\n    this.refresh()\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.message-container {\r\n  min-height: 100vh;\r\n  background: #f8f8f8;\r\n  padding-bottom: 100rpx;\r\n}\r\n\r\n/* Á±ªÂûãÂàáÊç¢ */\r\n.type-tabs {\r\n  display: flex;\r\n  background: #fff;\r\n  padding: 20rpx 0;\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.tab-item {\r\n  flex: 1;\r\n  text-align: center;\r\n  position: relative;\r\n}\r\n\r\n.tab-name {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  padding: 10rpx 0;\r\n}\r\n\r\n.tab-active .tab-name {\r\n  color: #1890ff;\r\n  font-weight: bold;\r\n}\r\n\r\n.tab-active::after {\r\n  content: '';\r\n  position: absolute;\r\n  left: 50%;\r\n  bottom: -10rpx;\r\n  transform: translateX(-50%);\r\n  width: 40rpx;\r\n  height: 4rpx;\r\n  background: #1890ff;\r\n  border-radius: 2rpx;\r\n}\r\n\r\n.unread-badge {\r\n  position: absolute;\r\n  top: -10rpx;\r\n  right: 50%;\r\n  transform: translateX(20rpx);\r\n  background: #ff4d4f;\r\n  color: #fff;\r\n  font-size: 24rpx;\r\n  padding: 0 8rpx;\r\n  border-radius: 20rpx;\r\n  min-width: 32rpx;\r\n  height: 32rpx;\r\n  line-height: 32rpx;\r\n}\r\n\r\n/* Ê∂àÊÅØÂàóË°® */\r\n.message-list {\r\n  height: calc(100vh - 88rpx - 100rpx);\r\n}\r\n\r\n.message-item {\r\n  display: flex;\r\n  padding: 30rpx;\r\n  background: #fff;\r\n  margin-bottom: 2rpx;\r\n}\r\n\r\n.msg-unread {\r\n  background: #f6f6f6;\r\n}\r\n\r\n.msg-icon {\r\n  width: 80rpx;\r\n  height: 80rpx;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-right: 20rpx;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.msg-icon.order {\r\n  background: #e6f7ff;\r\n  color: #1890ff;\r\n}\r\n\r\n.msg-icon.approval {\r\n  background: #fff7e6;\r\n  color: #faad14;\r\n}\r\n\r\n.msg-icon.notice {\r\n  background: #f6ffed;\r\n  color: #52c41a;\r\n}\r\n\r\n.icon {\r\n  font-size: 40rpx;\r\n}\r\n\r\n.msg-content {\r\n  flex: 1;\r\n}\r\n\r\n.msg-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.msg-title {\r\n  font-size: 32rpx;\r\n  color: #333;\r\n  font-weight: bold;\r\n}\r\n\r\n.msg-time {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.msg-desc {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.5;\r\n}\r\n\r\n/* Âä†ËΩΩÊõ¥Â§ö */\r\n.loading-more {\r\n  text-align: center;\r\n  padding: 30rpx;\r\n  color: #999;\r\n  font-size: 24rpx;\r\n}\r\n\r\n/* Á©∫Áä∂ÊÄÅ */\r\n.empty-tip {\r\n  text-align: center;\r\n  padding: 100rpx 0;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n\r\n/* Â∫ïÈÉ®Êìç‰ΩúÊ†è */\r\n.action-bar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: #fff;\r\n  padding: 20rpx;\r\n  box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.action-btn {\r\n  width: 100%;\r\n  height: 80rpx;\r\n  line-height: 80rpx;\r\n  background: #1890ff;\r\n  color: #fff;\r\n  font-size: 32rpx;\r\n  border-radius: 40rpx;\r\n  margin: 0;\r\n}\r\n</style> ","import MiniProgramPage from 'D:/yx01/UiApp/pd07/pd071/pages/message/message.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}