{"version":3,"file":"loading.js","sources":["utils/loading.js"],"sourcesContent":["class LoadingManager {\r\n  constructor() {\r\n    this.count = 0\r\n    this.lastTimer = null\r\n  }\r\n\r\n  // 显示加载\r\n  show(title = '加载中...') {\r\n    this.count++\r\n    \r\n    // 清除上一次的定时器\r\n    if(this.lastTimer) {\r\n      clearTimeout(this.lastTimer)\r\n      this.lastTimer = null\r\n    }\r\n\r\n    try {\r\n      uni.showLoading({\r\n        title,\r\n        mask: true\r\n      })\r\n    } catch(e) {\r\n      console.error('显示loading失败:', e)\r\n    }\r\n  }\r\n\r\n  // 隐藏加载\r\n  hide() {\r\n    this.count--\r\n    \r\n    // 只有当计数为0时才真正隐藏\r\n    if(this.count <= 0) {\r\n      this.count = 0\r\n      \r\n      // 延迟关闭，避免闪烁\r\n      this.lastTimer = setTimeout(() => {\r\n        try {\r\n          uni.hideLoading()\r\n        } catch(e) {\r\n          // 忽略hideLoading的错误\r\n          console.warn('隐藏loading失败:', e)\r\n        }\r\n        this.lastTimer = null\r\n      }, 100)\r\n    }\r\n  }\r\n\r\n  // 强制隐藏所有loading\r\n  hideAll() {\r\n    this.count = 0\r\n    try {\r\n      uni.hideLoading()\r\n    } catch(e) {\r\n      console.warn('强制隐藏loading失败:', e)\r\n    }\r\n  }\r\n}\r\n\r\nexport const loading = new LoadingManager()\r\n\r\n// 请求拦截器中间件\r\nexport function loadingInterceptor(options = {}) {\r\n  const title = options.title || '加载中...'\r\n  \r\n  return {\r\n    // 请求前显示loading\r\n    request(config) {\r\n      if(config.loading !== false) {\r\n        loading.show(title)\r\n      }\r\n      return config\r\n    },\r\n    \r\n    // 响应后隐藏loading\r\n    response(response) {\r\n      if(response.config && response.config.loading !== false) {\r\n        loading.hide()\r\n      }\r\n      return response\r\n    },\r\n    \r\n    // 错误时也要隐藏loading\r\n    error(error) {\r\n      loading.hide()\r\n      return Promise.reject(error)\r\n    }\r\n  }\r\n} "],"names":["uni"],"mappings":";;AAAA,MAAM,eAAe;AAAA,EACnB,cAAc;AACZ,SAAK,QAAQ;AACb,SAAK,YAAY;AAAA,EAClB;AAAA;AAAA,EAGD,KAAK,QAAQ,UAAU;AACrB,SAAK;AAGL,QAAG,KAAK,WAAW;AACjB,mBAAa,KAAK,SAAS;AAC3B,WAAK,YAAY;AAAA,IAClB;AAED,QAAI;AACFA,oBAAAA,MAAI,YAAY;AAAA,QACd;AAAA,QACA,MAAM;AAAA,MACd,CAAO;AAAA,IACF,SAAO,GAAG;AACTA,oBAAAA,+CAAc,gBAAgB,CAAC;AAAA,IAChC;AAAA,EACF;AAAA;AAAA,EAGD,OAAO;AACL,SAAK;AAGL,QAAG,KAAK,SAAS,GAAG;AAClB,WAAK,QAAQ;AAGb,WAAK,YAAY,WAAW,MAAM;AAChC,YAAI;AACFA,wBAAAA,MAAI,YAAa;AAAA,QAClB,SAAO,GAAG;AAETA,wBAAAA,MAAA,MAAA,QAAA,0BAAa,gBAAgB,CAAC;AAAA,QAC/B;AACD,aAAK,YAAY;AAAA,MAClB,GAAE,GAAG;AAAA,IACP;AAAA,EACF;AAAA;AAAA,EAGD,UAAU;AACR,SAAK,QAAQ;AACb,QAAI;AACFA,oBAAAA,MAAI,YAAa;AAAA,IAClB,SAAO,GAAG;AACTA,oBAAAA,MAAa,MAAA,QAAA,0BAAA,kBAAkB,CAAC;AAAA,IACjC;AAAA,EACF;AACH;AAEY,MAAC,UAAU,IAAI,eAAc;;"}